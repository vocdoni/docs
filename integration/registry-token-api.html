<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Registry Token API | Vocdoni</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="A decentralized self sovereign governance platform">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    
    <link rel="preload" href="/assets/css/0.styles.b4782a24.css" as="style"><link rel="preload" href="/assets/js/app.003a3fab.js" as="script"><link rel="preload" href="/assets/js/2.d75a9e61.js" as="script"><link rel="preload" href="/assets/js/57.bf2fdef7.js" as="script"><link rel="prefetch" href="/assets/js/10.7d736aa9.js"><link rel="prefetch" href="/assets/js/11.24f4b6a1.js"><link rel="prefetch" href="/assets/js/12.fbc7926a.js"><link rel="prefetch" href="/assets/js/13.1d48d867.js"><link rel="prefetch" href="/assets/js/14.f1695afd.js"><link rel="prefetch" href="/assets/js/15.fd5bd6ca.js"><link rel="prefetch" href="/assets/js/16.7848fcf4.js"><link rel="prefetch" href="/assets/js/17.a09d0fce.js"><link rel="prefetch" href="/assets/js/18.2d6d7bd0.js"><link rel="prefetch" href="/assets/js/19.7ca86ba4.js"><link rel="prefetch" href="/assets/js/20.7610a2ee.js"><link rel="prefetch" href="/assets/js/21.a33e4585.js"><link rel="prefetch" href="/assets/js/22.cdbbe0cb.js"><link rel="prefetch" href="/assets/js/23.daf8da8a.js"><link rel="prefetch" href="/assets/js/24.33f4a899.js"><link rel="prefetch" href="/assets/js/25.ca7b1363.js"><link rel="prefetch" href="/assets/js/26.00dda6a7.js"><link rel="prefetch" href="/assets/js/27.9643f5df.js"><link rel="prefetch" href="/assets/js/28.95fc6467.js"><link rel="prefetch" href="/assets/js/29.6d11f8e1.js"><link rel="prefetch" href="/assets/js/3.87bd6438.js"><link rel="prefetch" href="/assets/js/30.5f4b8604.js"><link rel="prefetch" href="/assets/js/31.57338027.js"><link rel="prefetch" href="/assets/js/32.c6e6f766.js"><link rel="prefetch" href="/assets/js/33.ee83017b.js"><link rel="prefetch" href="/assets/js/34.9adc375a.js"><link rel="prefetch" href="/assets/js/35.5a5f7bb7.js"><link rel="prefetch" href="/assets/js/36.e2545582.js"><link rel="prefetch" href="/assets/js/37.0eb8cc70.js"><link rel="prefetch" href="/assets/js/38.84124562.js"><link rel="prefetch" href="/assets/js/39.bf4aa161.js"><link rel="prefetch" href="/assets/js/4.6ba5942f.js"><link rel="prefetch" href="/assets/js/40.11b0e7ee.js"><link rel="prefetch" href="/assets/js/41.e727669e.js"><link rel="prefetch" href="/assets/js/42.995b740c.js"><link rel="prefetch" href="/assets/js/43.6a147059.js"><link rel="prefetch" href="/assets/js/44.a2bf17a5.js"><link rel="prefetch" href="/assets/js/45.3ff1d0d1.js"><link rel="prefetch" href="/assets/js/46.c84ab2db.js"><link rel="prefetch" href="/assets/js/47.b5fc1bda.js"><link rel="prefetch" href="/assets/js/48.87932f25.js"><link rel="prefetch" href="/assets/js/49.1b5e3ca0.js"><link rel="prefetch" href="/assets/js/5.0c02ed2b.js"><link rel="prefetch" href="/assets/js/50.0c49f3da.js"><link rel="prefetch" href="/assets/js/51.05425652.js"><link rel="prefetch" href="/assets/js/52.51995a7a.js"><link rel="prefetch" href="/assets/js/53.cd441341.js"><link rel="prefetch" href="/assets/js/54.69d5ba43.js"><link rel="prefetch" href="/assets/js/55.496f36cc.js"><link rel="prefetch" href="/assets/js/56.f98a821f.js"><link rel="prefetch" href="/assets/js/58.f208592f.js"><link rel="prefetch" href="/assets/js/59.a1cf2460.js"><link rel="prefetch" href="/assets/js/6.75834963.js"><link rel="prefetch" href="/assets/js/60.59aefd15.js"><link rel="prefetch" href="/assets/js/7.0929d87c.js"><link rel="prefetch" href="/assets/js/8.66ffbfac.js"><link rel="prefetch" href="/assets/js/9.5e86fdd3.js">
    <link rel="stylesheet" href="/assets/css/0.styles.b4782a24.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Vocdoni</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/architecture/general.html" class="nav-link">
  Architecture
</a></div><div class="nav-item"><a href="https://blog.vocdoni.io/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Blog
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="/about-us/vision.html" class="nav-link">
  About us
</a></div><div class="nav-item"><a href="https://discord.gg/sQCxgYs" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Discord
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/architecture/general.html" class="nav-link">
  Architecture
</a></div><div class="nav-item"><a href="https://blog.vocdoni.io/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Blog
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="/about-us/vision.html" class="nav-link">
  About us
</a></div><div class="nav-item"><a href="https://discord.gg/sQCxgYs" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Discord
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><a href="/architecture/general" class="sidebar-heading clickable open"><span>Architecture</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/architecture/general.html" class="sidebar-link">Global Architecture</a></li><li><a href="/architecture/process-overview.html" class="sidebar-link">Process Overview</a></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/architecture/census/census-overview" class="sidebar-heading clickable"><span>The Census</span> <span class="arrow right"></span></a> <!----></section></li><li><a href="/architecture/components.html" class="sidebar-link">Component Overview</a></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/architecture/smart-contracts/entity-resolver" class="sidebar-heading clickable"><span>Smart Contracts</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/architecture/services/gateway" class="sidebar-heading clickable"><span>Services</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/architecture/data-schemes/entity-metadata" class="sidebar-heading clickable"><span>Data Schemes</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/architecture/protocol/json-api" class="sidebar-heading clickable"><span>Protocol</span> <span class="arrow right"></span></a> <!----></section></li><li><a href="/architecture/component-interaction.html" class="sidebar-link">Component Interaction</a></li><li><a href="/architecture/libraries-tooling.html" class="sidebar-link">Libraries and Tooling</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/integration/overview" class="sidebar-heading clickable"><span>Integration</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/integration/overview.html" class="sidebar-link">Overview</a></li><li><a href="/integration/getting-started-local-vochain.html" class="sidebar-link">Getting started with a local instance</a></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/integration/vaas-api" class="sidebar-heading clickable"><span>Voting as a Service</span> <span class="arrow right"></span></a> <!----></section></li><li><a href="/integration/manual-integration.html" class="sidebar-link">Manual Integration</a></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/integration/census/general" class="sidebar-heading clickable"><span>Census</span> <span class="arrow right"></span></a> <!----></section></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/deployment/gateway" class="sidebar-heading clickable"><span>Deployment</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/deployment/gateway.html" class="sidebar-link">Gateway Deployment (stage)</a></li><li><a href="/deployment/miner.html" class="sidebar-link">Miner Deployment</a></li><li><a href="/deployment/oracle.html" class="sidebar-link">Oracle Deployment (stage)</a></li><li><a href="/deployment/custom-vochain.html" class="sidebar-link">Custom Vochain Deployment</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/about-us/vision" class="sidebar-heading clickable"><span>About</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/about-us/vision.html" class="sidebar-link">Vision</a></li><li><a href="/about-us/how-we-work.html" class="sidebar-link">How We Work</a></li><li><section class="sidebar-group is-sub-group depth-1"><a href="/about-us/development-guidelines" class="sidebar-heading clickable"><span>Development Guidelines</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/about-us/development-guidelines.html" class="sidebar-link">Development guidelines</a></li><li><a href="/about-us/repository-branching.html" class="sidebar-link">Repository and branching guidelines</a></li></ul></section></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="registry-token-api"><a href="#registry-token-api" class="header-anchor">#</a> Registry Token API</h1> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>This section is deprecated</p></div> <p>The token API allows organizations to take control over the user tokens required for user registration on the Vocdoni registry backend.</p> <p>The API can be accessed on a url like this <code>wss://vocdoni-registry-service/api/token</code>. It uses websockets with a JSON payload.</p> <h3 id="authentication"><a href="#authentication" class="header-anchor">#</a> Authentication</h3> <p>There is a common known secret between the entity and the vocdoni backend. This secret is used to compute the authHash field.</p> <p><code>authHash: hexadecimal(keccak256(field1+field2+fieldN+secret))</code></p> <p>The fields are concatenated strings. One of the fields must be a 32 bits <code>timestamp</code> (seconds).</p> <p>When computing the authHash the order of the fields is alphabetical using the field name, except from the last word that is is always the secret. This order in not obligatorily applied in the request body, just for the authHash calculation.</p> <p>The timestamp window tolerance is 3 seconds. If the request is processed outside of this tolerance window, the packet will be discarted.</p> <div class="language- extra-class"><pre class="language-text"><code>{
  &quot;id&quot;: &quot;req-12345678&quot;,
  &quot;request&quot;: {
    method: &quot;revoke&quot;,
    entityId: &quot;0x12345&quot;,
    token: &quot;xxx-yyy-zzz&quot;,
    authHash: &quot;0x123456789&quot;,
    timestamp: 1234567890
  }
}
</code></pre></div><p>secret = &quot;hello&quot;</p> <p><code>authHash = keccack256(&quot;0x123456&quot;+&quot;revoke&quot;+&quot;1234567890&quot;+&quot;xxx-yyy-zzz&quot;+&quot;hello&quot;)</code></p> <h3 id="methods"><a href="#methods" class="header-anchor">#</a> Methods</h3> <h5 id="token-revocation"><a href="#token-revocation" class="header-anchor">#</a> Token revocation</h5> <div class="language-json extra-class"><pre class="language-json"><code><span class="token comment">// Request</span>
<span class="token punctuation">{</span>
  <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;req-12345678&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;request&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    method<span class="token operator">:</span> <span class="token string">&quot;revoke&quot;</span><span class="token punctuation">,</span>
    entityId<span class="token operator">:</span> <span class="token string">&quot;0x12345&quot;</span><span class="token punctuation">,</span>
    token<span class="token operator">:</span> <span class="token string">&quot;xxx-yyy-zzz&quot;</span><span class="token punctuation">,</span>
    timestamp<span class="token operator">:</span> <span class="token number">1234567890</span><span class="token punctuation">,</span>
    authHash<span class="token operator">:</span> <span class="token string">&quot;0x123456789&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// Response</span>
<span class="token punctuation">{</span>
  <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;req-12345678&quot;</span><span class="token punctuation">,</span> <span class="token comment">// ID of the originating request</span>
  <span class="token property">&quot;response&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    ok<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    message<span class="token operator">:</span> <span class="token string">&quot;...&quot;</span><span class="token punctuation">,</span>  <span class="token comment">// Error message available only in case ok:false</span>
    timestamp<span class="token operator">:</span> <span class="token number">1234567890</span>
  <span class="token punctuation">}</span>
  <span class="token property">&quot;signature&quot;</span><span class="token operator">:</span> <span class="token string">&quot;0x1234...&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div><h5 id="token-status"><a href="#token-status" class="header-anchor">#</a> Token status</h5> <div class="language-json extra-class"><pre class="language-json"><code><span class="token comment">// Request</span>
<span class="token punctuation">{</span>
  <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;req-12345678&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;request&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    method<span class="token operator">:</span> <span class="token string">&quot;status&quot;</span><span class="token punctuation">,</span>
    entityId<span class="token operator">:</span> <span class="token string">&quot;0x12345&quot;</span><span class="token punctuation">,</span>
    token<span class="token operator">:</span> <span class="token string">&quot;xxx-yyy-zzz&quot;</span><span class="token punctuation">,</span>
    timestamp<span class="token operator">:</span> <span class="token number">1234567890</span><span class="token punctuation">,</span>
    authHash<span class="token operator">:</span> <span class="token string">&quot;0x123456789&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// Response</span>
<span class="token punctuation">{</span>
  <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;req-12345678&quot;</span><span class="token punctuation">,</span> <span class="token comment">// ID of the originating request</span>
  <span class="token property">&quot;response&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    ok<span class="token operator">:</span> bool
    tokenStatus<span class="token operator">:</span> <span class="token string">&quot;available&quot;</span> | <span class="token string">&quot;registered&quot;</span> | <span class="token string">&quot;invalid&quot;</span>
    message<span class="token operator">:</span> <span class="token string">&quot;...&quot;</span><span class="token punctuation">,</span>  <span class="token comment">// Error message available only in case ok: false</span>
    timestamp<span class="token operator">:</span> <span class="token number">1234567890</span>
  <span class="token punctuation">}</span>
  <span class="token property">&quot;signature&quot;</span><span class="token operator">:</span> <span class="token string">&quot;0x1234...&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div><h5 id="token-batch-generation"><a href="#token-batch-generation" class="header-anchor">#</a> Token batch generation</h5> <div class="language-json extra-class"><pre class="language-json"><code><span class="token comment">// Request</span>
<span class="token punctuation">{</span>
  <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;req-12345678&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;request&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    method<span class="token operator">:</span> <span class="token string">&quot;generate&quot;</span><span class="token punctuation">,</span>
    amount<span class="token operator">:</span> <span class="token number">1000</span><span class="token punctuation">,</span> 
    entityId<span class="token operator">:</span> <span class="token string">&quot;0x12345&quot;</span><span class="token punctuation">,</span>
    timestamp<span class="token operator">:</span> <span class="token number">1234567890</span><span class="token punctuation">,</span>
    authHash<span class="token operator">:</span> <span class="token string">&quot;0x123456789&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// Response</span>
<span class="token punctuation">{</span>
    ok<span class="token operator">:</span> bool
    tokens<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;&quot;</span>xxx-yyy-zzz<span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;yyy-zzz-xxx&quot;</span><span class="token punctuation">]</span>
    message<span class="token operator">:</span> <span class="token string">&quot;...&quot;</span><span class="token punctuation">,</span>  <span class="token comment">// Error message available only in case ok: false</span>
    timestamp<span class="token operator">:</span> <span class="token number">1234567890</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="full-example"><a href="#full-example" class="header-anchor">#</a> Full example</h4> <p>A full working example with secret=<code>test</code>.</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
<span class="token property">&quot;request&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span>
    <span class="token property">&quot;amount&quot;</span><span class="token operator">:</span><span class="token number">5</span><span class="token punctuation">,</span>
    <span class="token property">&quot;authHash&quot;</span><span class="token operator">:</span><span class="token string">&quot;6853b0b189bd0b69a288e458299b2f8ea4a2ee2f08e0d88a255edf10b891e9c9&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;entityId&quot;</span><span class="token operator">:</span><span class="token string">&quot;590289d82938b894c816d814244e616a893a0bf39117f80a21815179c5c01c8c&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;method&quot;</span><span class="token operator">:</span><span class="token string">&quot;generate&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;timestamp&quot;</span><span class="token operator">:</span><span class="token number">1595323066</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;id&quot;</span><span class="token operator">:</span><span class="token string">&quot;req-814&quot;</span>
<span class="token punctuation">}</span>

<span class="token punctuation">{</span>
<span class="token property">&quot;response&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span>
    <span class="token property">&quot;ok&quot;</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token property">&quot;request&quot;</span><span class="token operator">:</span><span class="token string">&quot;814&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;timestamp&quot;</span><span class="token operator">:</span><span class="token number">1595323066</span><span class="token punctuation">,</span>
    <span class="token property">&quot;tokens&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">&quot;f45a5966-f44f-4c7b-b70e-900ca49f18f7&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;a209816a-2999-441a-b921-0c8037814673&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;b3ed5bbd-6e28-43eb-806c-dedae2bc8f21&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;9435e251-73a1-48e4-bf57-fdfb29b9df2b&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;02d5af0a-0128-467c-9ab0-63787c0b62e6&quot;</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;id&quot;</span><span class="token operator">:</span><span class="token string">&quot;req-814&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;signature&quot;</span><span class="token operator">:</span><span class="token string">&quot;850c7ea5a360e599dbbd1d3c3b8428ead6025e460a2f33be0bb2e44ff94e0cd97fc48da44d4cfd69d9d1ad99df03e8ff3c74442d314d25a5d88608c1a0da018801&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="reference-javascript-client"><a href="#reference-javascript-client" class="header-anchor">#</a> Reference JavaScript client</h3> <p>Dependencies (tested versions): <a href="https://docs.ethers.io/v5/api/utils/hashing/#utils-keccak256" target="_blank" rel="noopener noreferrer">ethers@4.0.47<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, <a href="https://github.com/websockets/ws" target="_blank" rel="noopener noreferrer">ws@7.3.1<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> WebSocket <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'ws'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> keccak256 <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;ethers&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>utils<span class="token punctuation">.</span>keccak256
<span class="token keyword">const</span> toUtf8Bytes <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;ethers&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>utils<span class="token punctuation">.</span>toUtf8Bytes

<span class="token keyword">const</span> ws <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WebSocket</span><span class="token punctuation">(</span><span class="token string">'ws://localhost:8000/api/token'</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> <span class="token function-variable function">generateAuthHash</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">fields<span class="token punctuation">,</span> secret</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  str <span class="token operator">=</span> fields<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">x<span class="token punctuation">,</span>y</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">String</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">String</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> secret
  <span class="token keyword">return</span> <span class="token function">keccak256</span><span class="token punctuation">(</span><span class="token function">toUtf8Bytes</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">)</span>  
<span class="token punctuation">}</span>

ws<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'message'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token function">incoming</span><span class="token punctuation">(</span><span class="token parameter">message</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'received: %s'</span><span class="token punctuation">,</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span>
    ws<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

ws<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'open'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token function">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> secret <span class="token operator">=</span> <span class="token string">&quot;test&quot;</span>

  <span class="token comment">// Generate request</span>
  <span class="token keyword">const</span> request <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  request<span class="token punctuation">.</span>method<span class="token operator">=</span> <span class="token string">&quot;status&quot;</span>

  <span class="token comment">// adjust timestamp precision to the server</span>
  request<span class="token punctuation">.</span>timestamp <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">1000</span><span class="token punctuation">)</span>
  request<span class="token punctuation">.</span>authHash <span class="token operator">=</span> <span class="token function">generateAuthHash</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Array</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>entityId<span class="token punctuation">,</span> request<span class="token punctuation">.</span>method<span class="token punctuation">,</span> request<span class="token punctuation">.</span>timestamp<span class="token punctuation">,</span> request<span class="token punctuation">.</span>token<span class="token punctuation">)</span><span class="token punctuation">,</span> secret<span class="token punctuation">)</span>  

  <span class="token comment">// Generate random request id</span>
  <span class="token keyword">const</span> rand <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
  <span class="token keyword">const</span> requestId <span class="token operator">=</span> <span class="token function">keccak256</span><span class="token punctuation">(</span><span class="token string">'0x'</span> <span class="token operator">+</span> rand<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> msg <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;id&quot;</span><span class="token operator">:</span> requestId<span class="token punctuation">,</span>
    <span class="token string">&quot;request&quot;</span><span class="token operator">:</span> request
  <span class="token punctuation">}</span>
  ws<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

ws<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token function">error</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="callback"><a href="#callback" class="header-anchor">#</a> Callback</h3> <p>The organization can define an HTTP callback that will be triggered on some registration events.</p> <p>The callback definition looks like this:</p> <p><code>https://domain.com/callback?authHash={AUTHASH}&amp;event={EVENT}&amp;timestamp={TIMESTAMP}&amp;token={TOKEN}</code></p> <p>The parameters between braces will be replaced on each callback call. So <code>{EVENT}</code> will became <code>register</code> on the register callback.</p> <p>The <code>authHash</code> is computed the same way described above <code>alphabetical order of field values + shared secret</code> thus <code>AUTHASH = Keccak256(event + ts + token + secret)</code>.</p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">7/28/2021, 2:05:34 AM</span></div></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.003a3fab.js" defer></script><script src="/assets/js/2.d75a9e61.js" defer></script><script src="/assets/js/57.bf2fdef7.js" defer></script>
  </body>
</html>

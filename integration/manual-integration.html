<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Manual Integration | Vocdoni</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="A decentralized self sovereign governance platform">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    
    <link rel="preload" href="/assets/css/0.styles.b4782a24.css" as="style"><link rel="preload" href="/assets/js/app.003a3fab.js" as="script"><link rel="preload" href="/assets/js/2.d75a9e61.js" as="script"><link rel="preload" href="/assets/js/55.496f36cc.js" as="script"><link rel="prefetch" href="/assets/js/10.7d736aa9.js"><link rel="prefetch" href="/assets/js/11.24f4b6a1.js"><link rel="prefetch" href="/assets/js/12.fbc7926a.js"><link rel="prefetch" href="/assets/js/13.1d48d867.js"><link rel="prefetch" href="/assets/js/14.f1695afd.js"><link rel="prefetch" href="/assets/js/15.fd5bd6ca.js"><link rel="prefetch" href="/assets/js/16.7848fcf4.js"><link rel="prefetch" href="/assets/js/17.a09d0fce.js"><link rel="prefetch" href="/assets/js/18.2d6d7bd0.js"><link rel="prefetch" href="/assets/js/19.7ca86ba4.js"><link rel="prefetch" href="/assets/js/20.7610a2ee.js"><link rel="prefetch" href="/assets/js/21.a33e4585.js"><link rel="prefetch" href="/assets/js/22.cdbbe0cb.js"><link rel="prefetch" href="/assets/js/23.daf8da8a.js"><link rel="prefetch" href="/assets/js/24.33f4a899.js"><link rel="prefetch" href="/assets/js/25.ca7b1363.js"><link rel="prefetch" href="/assets/js/26.00dda6a7.js"><link rel="prefetch" href="/assets/js/27.9643f5df.js"><link rel="prefetch" href="/assets/js/28.95fc6467.js"><link rel="prefetch" href="/assets/js/29.6d11f8e1.js"><link rel="prefetch" href="/assets/js/3.87bd6438.js"><link rel="prefetch" href="/assets/js/30.5f4b8604.js"><link rel="prefetch" href="/assets/js/31.57338027.js"><link rel="prefetch" href="/assets/js/32.c6e6f766.js"><link rel="prefetch" href="/assets/js/33.ee83017b.js"><link rel="prefetch" href="/assets/js/34.9adc375a.js"><link rel="prefetch" href="/assets/js/35.5a5f7bb7.js"><link rel="prefetch" href="/assets/js/36.e2545582.js"><link rel="prefetch" href="/assets/js/37.0eb8cc70.js"><link rel="prefetch" href="/assets/js/38.84124562.js"><link rel="prefetch" href="/assets/js/39.bf4aa161.js"><link rel="prefetch" href="/assets/js/4.6ba5942f.js"><link rel="prefetch" href="/assets/js/40.11b0e7ee.js"><link rel="prefetch" href="/assets/js/41.e727669e.js"><link rel="prefetch" href="/assets/js/42.995b740c.js"><link rel="prefetch" href="/assets/js/43.6a147059.js"><link rel="prefetch" href="/assets/js/44.a2bf17a5.js"><link rel="prefetch" href="/assets/js/45.3ff1d0d1.js"><link rel="prefetch" href="/assets/js/46.c84ab2db.js"><link rel="prefetch" href="/assets/js/47.b5fc1bda.js"><link rel="prefetch" href="/assets/js/48.87932f25.js"><link rel="prefetch" href="/assets/js/49.1b5e3ca0.js"><link rel="prefetch" href="/assets/js/5.0c02ed2b.js"><link rel="prefetch" href="/assets/js/50.0c49f3da.js"><link rel="prefetch" href="/assets/js/51.05425652.js"><link rel="prefetch" href="/assets/js/52.51995a7a.js"><link rel="prefetch" href="/assets/js/53.cd441341.js"><link rel="prefetch" href="/assets/js/54.69d5ba43.js"><link rel="prefetch" href="/assets/js/56.f98a821f.js"><link rel="prefetch" href="/assets/js/57.bf2fdef7.js"><link rel="prefetch" href="/assets/js/58.f208592f.js"><link rel="prefetch" href="/assets/js/59.a1cf2460.js"><link rel="prefetch" href="/assets/js/6.75834963.js"><link rel="prefetch" href="/assets/js/60.59aefd15.js"><link rel="prefetch" href="/assets/js/7.0929d87c.js"><link rel="prefetch" href="/assets/js/8.66ffbfac.js"><link rel="prefetch" href="/assets/js/9.5e86fdd3.js">
    <link rel="stylesheet" href="/assets/css/0.styles.b4782a24.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Vocdoni</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/architecture/general.html" class="nav-link">
  Architecture
</a></div><div class="nav-item"><a href="https://blog.vocdoni.io/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Blog
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="/about-us/vision.html" class="nav-link">
  About us
</a></div><div class="nav-item"><a href="https://discord.gg/sQCxgYs" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Discord
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/architecture/general.html" class="nav-link">
  Architecture
</a></div><div class="nav-item"><a href="https://blog.vocdoni.io/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Blog
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="/about-us/vision.html" class="nav-link">
  About us
</a></div><div class="nav-item"><a href="https://discord.gg/sQCxgYs" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Discord
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><a href="/architecture/general" class="sidebar-heading clickable"><span>Architecture</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/architecture/general.html" class="sidebar-link">Global Architecture</a></li><li><a href="/architecture/process-overview.html" class="sidebar-link">Process Overview</a></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/architecture/census/census-overview" class="sidebar-heading clickable"><span>The Census</span> <span class="arrow right"></span></a> <!----></section></li><li><a href="/architecture/components.html" class="sidebar-link">Component Overview</a></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/architecture/smart-contracts/entity-resolver" class="sidebar-heading clickable"><span>Smart Contracts</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/architecture/services/gateway" class="sidebar-heading clickable"><span>Services</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/architecture/data-schemes/entity-metadata" class="sidebar-heading clickable"><span>Data Schemes</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/architecture/protocol/json-api" class="sidebar-heading clickable"><span>Protocol</span> <span class="arrow right"></span></a> <!----></section></li><li><a href="/architecture/component-interaction.html" class="sidebar-link">Component Interaction</a></li><li><a href="/architecture/libraries-tooling.html" class="sidebar-link">Libraries and Tooling</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/integration/overview" class="sidebar-heading clickable open"><span>Integration</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/integration/overview.html" class="sidebar-link">Overview</a></li><li><a href="/integration/getting-started-local-vochain.html" class="sidebar-link">Getting started with a local instance</a></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/integration/vaas-api" class="sidebar-heading clickable"><span>Voting as a Service</span> <span class="arrow right"></span></a> <!----></section></li><li><a href="/integration/manual-integration.html" aria-current="page" class="active sidebar-link">Manual Integration</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/integration/manual-integration.html#how-it-works" class="sidebar-link">How it works</a></li><li class="sidebar-sub-header"><a href="/integration/manual-integration.html#get-started" class="sidebar-link">Get started</a></li></ul></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/integration/census/general" class="sidebar-heading clickable"><span>Census</span> <span class="arrow right"></span></a> <!----></section></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/deployment/gateway" class="sidebar-heading clickable"><span>Deployment</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/deployment/gateway.html" class="sidebar-link">Gateway Deployment (stage)</a></li><li><a href="/deployment/miner.html" class="sidebar-link">Miner Deployment</a></li><li><a href="/deployment/oracle.html" class="sidebar-link">Oracle Deployment (stage)</a></li><li><a href="/deployment/custom-vochain.html" class="sidebar-link">Custom Vochain Deployment</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/about-us/vision" class="sidebar-heading clickable"><span>About</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/about-us/vision.html" class="sidebar-link">Vision</a></li><li><a href="/about-us/how-we-work.html" class="sidebar-link">How We Work</a></li><li><section class="sidebar-group is-sub-group depth-1"><a href="/about-us/development-guidelines" class="sidebar-heading clickable"><span>Development Guidelines</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/about-us/development-guidelines.html" class="sidebar-link">Development guidelines</a></li><li><a href="/about-us/repository-branching.html" class="sidebar-link">Repository and branching guidelines</a></li></ul></section></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="manual-integration"><a href="#manual-integration" class="header-anchor">#</a> Manual Integration</h1> <p>The following section is an excerpt of the article published on the <a href="https://blog.vocdoni.io/" target="_blank" rel="noopener noreferrer">Vocdoni Blog<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, called <a href="https://blog.vocdoni.io/introducing-voting-as-a-service/" target="_blank" rel="noopener noreferrer">Introducing Voting as a Service<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <p>This article was written before the <a href="/integration/vaas-api.html">VaaS API</a> was available, and it details a low-level way to use the Vocdoni VaaS directly with the dvote-js package. Integrators can now use the high-level API instead.</p> <hr> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>The contents of this article are outdated. An up to date version will be available soon. <br>
Use the article as an introduction and combine it with this <a href="https://github.com/vocdoni/dvote-js/blob/main/example/off-chain-census/index.ts#L24" target="_blank" rel="noopener noreferrer">end-to-end example<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p></div> <p>Conducting secure voting processes is far from simple, and today we are only focusing on the first steps. Vocdoni is conceived as a set of decentralized components which can operate as a whole.</p> <ul><li>The Ethereum blockchain to declare organizations and their voting processes (Layer 1).</li> <li>Decentralized metadata retrieved via IPFS.</li> <li>The purpose-specific voting blockchain, where votes are validated and registered (Layer 2)</li> <li>The public gateways, providing easy access to the decentralized components above.</li> <li>The census registry (the user database to generate the census).</li></ul> <p>Every single one of these components can be replaced by your own instances without any kind of vendor lock-in.</p> <p>If your organization already has an existing user database, Vocdoni's Governance as a Service is the best fit.</p> <h2 id="how-it-works"><a href="#how-it-works" class="header-anchor">#</a> How it works</h2> <h3 id="before-the-process"><a href="#before-the-process" class="header-anchor">#</a> Before the process</h3> <p>In Vocdoni, identities arise from cryptographic key pairs (ECDSA). When people are added to a database, their <a href="https://en.wikipedia.org/wiki/Public-key_cryptography" target="_blank" rel="noopener noreferrer">public key<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> is registered.</p> <p>To create a voting process, the first step is to generate a snapshot of the census. The census consists of a <a href="https://en.wikipedia.org/wiki/Merkle_tree" target="_blank" rel="noopener noreferrer">Merkle Tree<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> with the <a href="https://en.wikipedia.org/wiki/Public-key_cryptography" target="_blank" rel="noopener noreferrer">public keys<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> of everyone who is eligible to vote. No personal data is involved.</p> <p>The census snapshot is then uploaded and pinned to a decentralized storage like <a href="https://ipfs.io" target="_blank" rel="noopener noreferrer">IPFS<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, which ensures that everyone will be able to check it out.</p> <p>Then the voting process details are declared on the <a href="https://ethereum.org/en/developers/" target="_blank" rel="noopener noreferrer">Ethereum<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> <a href="https://en.wikipedia.org/wiki/Smart_contract" target="_blank" rel="noopener noreferrer">smart contract<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, so that anyone with internet access can fetch them, get the metadata, get the location of the census, etc.</p> <h3 id="during-the-process"><a href="#during-the-process" class="header-anchor">#</a> During the process</h3> <p>Using their private key and a <a href="https://docs.vocdoni.io/#/architecture/services/gateway" target="_blank" rel="noopener noreferrer">decentralized Gateway<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, eligible voters can fetch a Merkle proof to prove that their key pair belongs to the census <a href="https://en.wikipedia.org/wiki/Merkle_tree" target="_blank" rel="noopener noreferrer">Merkle Tree<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>. They sign their vote envelope with the key above and submit it using whatever <a href="https://github.com/vocdoni/go-dvote#dvotenode" target="_blank" rel="noopener noreferrer">Gateway<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> they like. Even their own.</p> <p>Votes are relayed to the custom voting blockchain, validated and included in the next block.</p> <p>As the process goes on, anyone with network access can listen for vote transactions, verify them by themselves or even use the <a href="https://explorer.vote" target="_blank" rel="noopener noreferrer">block explorer<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> to do it manually.</p> <h3 id="after-the-process"><a href="#after-the-process" class="header-anchor">#</a> After the process</h3> <p>When the vote is over, the oracle will trigger a process end transaction. At this point, the process will stop accepting valid votes and Gateways will be able to compute the scrutiny of the process. Even your own gateways can.</p> <p>Optionally, an oracle can read the final results and publish them on the smart contract where the process was created, so that results are notarized on the Ethereum blockchain.</p> <p>Since the process operates on an L2 sidechain, users don't even need to know about <a href="https://metamask.io/" target="_blank" rel="noopener noreferrer">metamask<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, exchanges or <a href="https://etherscan.io/gastracker" target="_blank" rel="noopener noreferrer">gas fees<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>. All they do is open an app or a web site and use their keys (under the hood) to sign and submit a vote envelope. The governance infrastructure does the rest.</p> <h2 id="get-started"><a href="#get-started" class="header-anchor">#</a> Get started</h2> <p>Enough talk, let's see how you can create an entity and publish your first voting process.</p> <h3 id="entity-creation"><a href="#entity-creation" class="header-anchor">#</a> Entity creation</h3> <p>Make sure you have <a href="https://nodejs.org" target="_blank" rel="noopener noreferrer">Node.js<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 12 installed on your computer.</p> <p>In an empty folder, create a <code>package.json</code> file by running</p> <div class="language-json extra-class"><pre class="language-json"><code>$ npm init -y
Wrote to /home/user/dev/governance-as-a-service/package.json<span class="token operator">:</span>

<span class="token punctuation">{</span>
  <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;governance-as-a-service&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;version&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1.0.0&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;description&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;main&quot;</span><span class="token operator">:</span> <span class="token string">&quot;index.js&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;test&quot;</span><span class="token operator">:</span> <span class="token string">&quot;echo \&quot;Error: no test specified\&quot; &amp;&amp; exit 1&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;keywords&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">&quot;author&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;license&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ISC&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Next, install the DVoteJS dependency and two dev dependencies to support TypeScript:</p> <div class="language- extra-class"><pre class="language-text"><code>$ npm i dvote-js
$ npm i -D typescript ts-node
</code></pre></div><p>Edit the <code>scripts</code> section of <code>package.json</code> and leave it like this:</p> <div class="language-json extra-class"><pre class="language-json"><code>  <span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;main&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ts-node index.ts&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><p>Then, let's create a file named <code>index.ts</code> and create a function to generate the wallet of our new entity:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Wallet <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;ethers&quot;</span>

<span class="token keyword">function</span> <span class="token function">makeEntityWallet</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Creating entity wallet&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> entityWallet <span class="token operator">=</span> Wallet<span class="token punctuation">.</span><span class="token function">createRandom</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Entity address:&quot;</span><span class="token punctuation">,</span> entityWallet<span class="token punctuation">.</span>address<span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Entity private key:&quot;</span><span class="token punctuation">,</span> entityWallet<span class="token punctuation">.</span>privateKey<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token function">makeEntityWallet</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

</code></pre></div><p>To check that it works, let's run <code>npm run main</code>:</p> <div class="language- extra-class"><pre class="language-text"><code>$ npm run main
Creating entity wallet
Entity address: 0x1048d8cB20fE806389802ba48E2647dc85aB779a
Entity private key: 0x6d88d78a4a76e42144b6867fdff89477f0a3b805d85b97cd46387a2f770f91f1
</code></pre></div><p>So here's our wallet, what's next?</p> <p>In this example, we will be using an Ethereum testnet called Sokol. Write down your private key and and use the address to request some test coins from <a href="https://faucet-sokol.herokuapp.com/" target="_blank" rel="noopener noreferrer">the faucet<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>. You will need them to send some transactions.</p> <p><img src="https://blog.vocdoni.io/content/images/2020/09/poafaucet.png" alt="Sokol Faucet" title="Sokol faucet"></p> <p>Now, instead of creating a random wallet, we should use the one that received the test ether. In the lines above, replace this:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> entityWallet <span class="token operator">=</span> Wallet<span class="token punctuation">.</span><span class="token function">createRandom</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><p>Into this:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// Use your private key here</span>
<span class="token keyword">const</span> entityWallet <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Wallet</span><span class="token punctuation">(</span><span class="token string">&quot;0x6d88d78a4a76e42144b6867fdff89477f0a3b805d85b97cd46387a2f770f91f1&quot;</span><span class="token punctuation">)</span>
</code></pre></div><p>Obviously, make sure to store any real private key nowhere within the source code or Git in general.</p> <p>Now we need to get a pool of gateways and connect to one of them:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> GatewayPool <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;dvote-js/dist/net/gateway-pool&quot;</span>

<span class="token keyword">let</span> pool<span class="token operator">:</span> GatewayPool

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Get a pool of gateways to connect to the network</span>
    pool <span class="token operator">=</span> <span class="token keyword">await</span> GatewayPool<span class="token punctuation">.</span><span class="token function">discover</span><span class="token punctuation">(</span><span class="token punctuation">{</span> networkId<span class="token operator">:</span> <span class="token constant">NETWORK_ID</span><span class="token punctuation">,</span> bootnodesContentUri<span class="token operator">:</span> <span class="token constant">GATEWAY_BOOTNODE_URI</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">await</span> pool<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> <span class="token function-variable function">disconnect</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> pool<span class="token punctuation">.</span><span class="token function">disconnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><p>Then, let's define the metadata of our Entity and make it available on IPFS and Ethereum. Add the following code to <code>index.ts</code>:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> EntityMetadata <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;dvote-js&quot;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> updateEntity <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;dvote-js/dist/api/entity&quot;</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">registerEntity</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Make a copy of the metadata template and customize it</span>
    <span class="token keyword">const</span> entityMetadata<span class="token operator">:</span> EntityMetadata <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> Models<span class="token punctuation">.</span>Entity<span class="token punctuation">.</span>EntityMetadataTemplate<span class="token punctuation">)</span>

    entityMetadata<span class="token punctuation">.</span>name<span class="token punctuation">.</span>default <span class="token operator">=</span> <span class="token string">&quot;Vilafourier&quot;</span>
    entityMetadata<span class="token punctuation">.</span>description<span class="token punctuation">.</span>default <span class="token operator">=</span> <span class="token string">&quot;Official communication and participation channel of the city council&quot;</span>
    entityMetadata<span class="token punctuation">.</span>media <span class="token operator">=</span> <span class="token punctuation">{</span>
        avatar<span class="token operator">:</span> <span class="token string">'https://my-organization.org/logo.png'</span><span class="token punctuation">,</span>
        header<span class="token operator">:</span> <span class="token string">'https://my-organization.org/header.jpeg'</span>
    <span class="token punctuation">}</span>
    entityMetadata<span class="token punctuation">.</span>actions <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>

    <span class="token keyword">const</span> contentUri <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">updateEntity</span><span class="token punctuation">(</span>entityWallet<span class="token punctuation">.</span>address<span class="token punctuation">,</span> entityMetadata<span class="token punctuation">,</span> entityWallet<span class="token punctuation">,</span> pool<span class="token punctuation">)</span>

    <span class="token comment">// Show stored values</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;The entity has been defined&quot;</span><span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>contentUri<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>And then:</p> <div class="language- extra-class"><pre class="language-text"><code>$ npm run main
Setting the entity metadata
WARNING: Multiple definitions for addr
WARNING: Multiple definitions for setAddr
The entity has been defined
ipfs://QmdK5TnHDXPt4xozkuboyKP94RTrUxFr1z9Pkv5qhfahFG
</code></pre></div><p>Done!</p> <p>This is what we just did:</p> <ul><li>We created JSON metadata containing the custom details of our entity</li> <li>We pinned the JSON content on IPFS using a gateway from the pool</li> <li>The hash of our metadata is <code>QmdK5TnHDXPt4xozkuboyKP94RTrUxFr1z9Pkv5qhfahFG</code> and should be available <a href="https://ipfs.io/ipfs/QmdK5TnHDXPt4xozkuboyKP94RTrUxFr1z9Pkv5qhfahFG" target="_blank" rel="noopener noreferrer">from any IPFS peer<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li>An Ethereum transaction was sent to the entities contract, defining the pointer to our new metadata.</li></ul> <p>The value on the smart contract can only be updated by our wallet, the blockchain ensures the integrity of our data and IPFS ensures its global availability.</p> <h4 id="visualizer"><a href="#visualizer" class="header-anchor">#</a> Visualizer</h4> <p>To check that our entity is properly declared, we can check it on the visualizer: <code>https://app.dev.vocdoni.net/entities/#/&lt;entity-id&gt;</code></p> <p>This is the link <a href="https://app.dev.vocdoni.net/entities/#/0xdeea56f124dd3e73bcbc210fc382154a11f3bab227af55927139c887e15573e4" target="_blank" rel="noopener noreferrer">in our case<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <div class="custom-block tip"><p>Keep in mind that we're using a testnet and some of the data might be eventually disposed.</p></div> <h3 id="census-generation"><a href="#census-generation" class="header-anchor">#</a> Census generation</h3> <p>Our entity is ready, now it can handle voting processes. But before we can create one, we need a census of the people who can vote.</p> <p>As we said, digital identities arise from a cryptographic keypair. The ideal scenario is when the identity is generated on the user's device and only the public key is shared, but for the sake of simplicity, we will create a few identities ourselves.</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">let</span> votersPublicKeys<span class="token operator">:</span> string<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>

<span class="token keyword">function</span> <span class="token function">populateCensusPublicKeys</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> wallet <span class="token operator">=</span> Wallet<span class="token punctuation">.</span><span class="token function">createRandom</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        votersPublicKeys<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>wallet<span class="token punctuation">[</span><span class="token string">&quot;signingKey&quot;</span><span class="token punctuation">]</span><span class="token punctuation">.</span>publicKey<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Voter's public keys&quot;</span><span class="token punctuation">,</span> votersPublicKeys<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Which results in</p> <div class="language- extra-class"><pre class="language-text"><code>Voter's public keys [
 '0x046f5ae433845ddc5d93a44b4aa3b9f654861372ada5f074b88bd18623dcbac5e4c3495f2f4f96e9053ce89f8befd3ad5424224948b84ba5a9292ef3f594003c46',
 '0x0460aaecd59d68dc63aa173f77d89476280d77b67c5793c5f166ff951eb4d761df8d57eab31e8064180027386ead992b74bd097461e0a44e80b371650f4c09370b',
  ...
]
</code></pre></div><p>Then we can upload the census claims to a gateway and publish it:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> addCensus<span class="token punctuation">,</span> addClaimBulk<span class="token punctuation">,</span> getRoot<span class="token punctuation">,</span> publishCensus <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;dvote-js/dist/api/census&quot;</span>

<span class="token keyword">let</span> merkleTreeOrigin<span class="token operator">:</span> string
<span class="token keyword">let</span> merkleRoot<span class="token operator">:</span> string

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">publishVoteCensus</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Prepare the census parameters</span>
    <span class="token keyword">const</span> censusName <span class="token operator">=</span> <span class="token string">&quot;Vilafourier all members #&quot;</span> <span class="token operator">+</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> adminPublicKeys <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token keyword">await</span> entityWallet<span class="token punctuation">[</span><span class="token string">&quot;signingKey&quot;</span><span class="token punctuation">]</span><span class="token punctuation">.</span>publicKey<span class="token punctuation">]</span>
    <span class="token keyword">const</span> publicKeyClaims <span class="token operator">=</span> votersPublicKeys<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">k</span> <span class="token operator">=&gt;</span> <span class="token function">digestHexClaim</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// hash the keys</span>

    <span class="token comment">// As the census does not exist yet, we create it (optional when it exists)</span>
    <span class="token keyword">let</span> <span class="token punctuation">{</span> censusId <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">addCensus</span><span class="token punctuation">(</span>censusName<span class="token punctuation">,</span> adminPublicKeys<span class="token punctuation">,</span> pool<span class="token punctuation">,</span> entityWallet<span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Census added: &quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>censusName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&quot; with ID </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>censusId<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>

    <span class="token comment">// Add claims to the new census</span>
    <span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">addClaimBulk</span><span class="token punctuation">(</span>censusId<span class="token punctuation">,</span> publicKeyClaims<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> pool<span class="token punctuation">,</span> entityWallet<span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Added&quot;</span><span class="token punctuation">,</span> votersPublicKeys<span class="token punctuation">.</span>length<span class="token punctuation">,</span> <span class="token string">&quot;claims to&quot;</span><span class="token punctuation">,</span> censusId<span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>result<span class="token punctuation">.</span>invalidClaims<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;Invalid claims&quot;</span><span class="token punctuation">,</span> result<span class="token punctuation">.</span>invalidClaims<span class="token punctuation">)</span>

    merkleRoot <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getRoot</span><span class="token punctuation">(</span>censusId<span class="token punctuation">,</span> pool<span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Census Merkle Root&quot;</span><span class="token punctuation">,</span> merkleRoot<span class="token punctuation">)</span>

    <span class="token comment">// Make it available publicly</span>
    merkleTreeOrigin <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">publishCensus</span><span class="token punctuation">(</span>censusId<span class="token punctuation">,</span> pool<span class="token punctuation">,</span> entityWallet<span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Census published on&quot;</span><span class="token punctuation">,</span> merkleTreeOrigin<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Which results in:</p> <div class="language- extra-class"><pre class="language-text"><code>Census added: &quot;Vilafourier all members #550262&quot; with ID 0x1048d8cB20fE806389802ba48E2647dc85aB779a/0x8e0c00cda17a132e2ce6c89072cc2037b0800c280c1ddba318eb2620fae2ff16
Added 10 claims to 0x1048d8cB20fE806389802ba48E2647dc85aB779a/0x8e0c00cda17a132e2ce6c89072cc2037b0800c280c1ddba318eb2620fae2ff16
Census Merkle Root 0xbf8572159929b4e37c40e2ce18fd46156e750a4aac1f06dbda3237edccc81115
Census published on ipfs://QmcTuUJbN1tEWA3nqHFU8N8iuUN2ymJoqW4UcKBzHuYrPw
</code></pre></div><p>Cool! Our entity is ready, and our first census is now public.</p> <h3 id="process-creation"><a href="#process-creation" class="header-anchor">#</a> Process creation</h3> <p>Now we are ready to create our fist process. To do so, we will use the values we generated previously and define the topic, the questions, the vote options, etc.</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> getEntityId <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;dvote-js/dist/api/entity&quot;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> estimateBlockAtDateTime<span class="token punctuation">,</span> createVotingProcess<span class="token punctuation">,</span> getVoteMetadata <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;dvote-js/dist/api/vote&quot;</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">createVotingProcess</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> myEntityAddress <span class="token operator">=</span> <span class="token keyword">await</span> entityWallet<span class="token punctuation">.</span><span class="token function">getAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> myEntityId <span class="token operator">=</span> <span class="token function">getEntityId</span><span class="token punctuation">(</span>myEntityAddress<span class="token punctuation">)</span>

    <span class="token keyword">const</span> startBlock <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">estimateBlockAtDateTime</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span>Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1000</span> <span class="token operator">*</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span> pool<span class="token punctuation">)</span>
    <span class="token keyword">const</span> numberOfBlocks <span class="token operator">=</span> <span class="token number">6</span> <span class="token operator">*</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">24</span> <span class="token comment">// 1 day (10s block time)</span>

    <span class="token keyword">const</span> processMetadata<span class="token operator">:</span> ProcessMetadata <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;version&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1.0&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;poll-vote&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;startBlock&quot;</span><span class="token operator">:</span> startBlock<span class="token punctuation">,</span>
        <span class="token string">&quot;numberOfBlocks&quot;</span><span class="token operator">:</span> numberOfBlocks<span class="token punctuation">,</span>
        <span class="token string">&quot;census&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token string">&quot;merkleRoot&quot;</span><span class="token operator">:</span> merkleRoot<span class="token punctuation">,</span>
            <span class="token string">&quot;merkleTree&quot;</span><span class="token operator">:</span> merkleTreeOrigin
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token string">&quot;details&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token string">&quot;entityId&quot;</span><span class="token operator">:</span> myEntityId<span class="token punctuation">,</span>
            <span class="token string">&quot;title&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token string">&quot;default&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Vilafourier public poll&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token string">&quot;description&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token string">&quot;default&quot;</span><span class="token operator">:</span> <span class="token string">&quot;This is our test poll using a decentralized blockchain to register votes&quot;</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token string">&quot;headerImage&quot;</span><span class="token operator">:</span> <span class="token string">&quot;https://images.unsplash.com/photo-1600190184658-4c4b088ec92c?ixlib=rb-1.2.1&amp;ixid=eyJhcHBfaWQiOjEyMDd9&amp;auto=format&amp;fit=crop&amp;w=1350&amp;q=80&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;streamUrl&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;questions&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                <span class="token punctuation">{</span>
                    <span class="token string">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;single-choice&quot;</span><span class="token punctuation">,</span>
                    <span class="token string">&quot;question&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token string">&quot;default&quot;</span><span class="token operator">:</span> <span class="token string">&quot;CEO&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
                    <span class="token string">&quot;description&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token string">&quot;default&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Chief Executive Officer&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
                    <span class="token string">&quot;voteOptions&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                        <span class="token punctuation">{</span> <span class="token string">&quot;title&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token string">&quot;default&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Yellow candidate&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;value&quot;</span><span class="token operator">:</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
                        <span class="token punctuation">{</span> <span class="token string">&quot;title&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token string">&quot;default&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Pink candidate&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;value&quot;</span><span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
                        <span class="token punctuation">{</span> <span class="token string">&quot;title&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token string">&quot;default&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Abstention&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;value&quot;</span><span class="token operator">:</span> <span class="token number">2</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
                        <span class="token punctuation">{</span> <span class="token string">&quot;title&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token string">&quot;default&quot;</span><span class="token operator">:</span> <span class="token string">&quot;White vote&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;value&quot;</span><span class="token operator">:</span> <span class="token number">3</span> <span class="token punctuation">}</span>
                    <span class="token punctuation">]</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token punctuation">{</span>
                    <span class="token string">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;single-choice&quot;</span><span class="token punctuation">,</span>
                    <span class="token string">&quot;question&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token string">&quot;default&quot;</span><span class="token operator">:</span> <span class="token string">&quot;CFO&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
                    <span class="token string">&quot;description&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token string">&quot;default&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Chief Financial Officer&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
                    <span class="token string">&quot;voteOptions&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                        <span class="token punctuation">{</span> <span class="token string">&quot;title&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token string">&quot;default&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Yellow candidate&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;value&quot;</span><span class="token operator">:</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
                        <span class="token punctuation">{</span> <span class="token string">&quot;title&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token string">&quot;default&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Pink candidate&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;value&quot;</span><span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
                        <span class="token punctuation">{</span> <span class="token string">&quot;title&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token string">&quot;default&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Abstention&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;value&quot;</span><span class="token operator">:</span> <span class="token number">2</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
                        <span class="token punctuation">{</span> <span class="token string">&quot;title&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token string">&quot;default&quot;</span><span class="token operator">:</span> <span class="token string">&quot;White vote&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;value&quot;</span><span class="token operator">:</span> <span class="token number">3</span> <span class="token punctuation">}</span>
                    <span class="token punctuation">]</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">const</span> processId <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">createVotingProcess</span><span class="token punctuation">(</span>processMetadata<span class="token punctuation">,</span> entityWallet<span class="token punctuation">,</span> pool<span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Process created:&quot;</span><span class="token punctuation">,</span> processId<span class="token punctuation">)</span>

    <span class="token comment">// Reading the process metadata back</span>
    <span class="token keyword">const</span> metadata <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getVoteMetadata</span><span class="token punctuation">(</span>processId<span class="token punctuation">,</span> pool<span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;The metadata is&quot;</span><span class="token punctuation">,</span> metadata<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Which looks like this:</p> <div class="language- extra-class"><pre class="language-text"><code>Process created: 0x82f42dc48bfbfa0bb1018bcb0f3a31f77d12ced1fda9566990d64d07be9a48a6
The metadata is {
  version: '1.0',
  type: 'poll-vote',
  startBlock: 2203,
  numberOfBlocks: 8640,
  census: {
    merkleRoot: '0x2044a23e328d75276a7e9e6bc1774eb67707597beba1cfdfde5e7fa174197101',
    merkleTree: 'ipfs://QmTFGgoDnMWhMU3BXxm4zTxeFZLPnRV1jiQgBqukzJPmo9'
  },
  details: {
    entityId: '0xdeea56f124dd3e73bcbc210fc382154a11f3bab227af55927139c887e15573e4',
    title: { default: 'Vilafourier public poll' },
    description: {
      default: 'This is our test poll using a decentralized blockchain to register votes'
    },
    headerImage: 'https://images.unsplash.com/photo-1600190184658-4c4b088ec92c?ixlib=rb-1.2.1&amp;ixid=eyJhcHBfaWQiOjEyMDd9&amp;auto=format&amp;fit=crop&amp;w=1350&amp;q=80',
    streamUrl: '',
    questions: [ [Object], [Object] ]
  }
}
</code></pre></div><p>So, we just...</p> <ul><li>Defined the metadata of our process</li> <li>Defined the  block at which we would like the process to start</li> <li>Declare the metadata of the process</li></ul> <p>As it happened before, the JSON metadata is pinned on IPFS and pointed to from the process smart contract. In addition, some metadata fields are also stored on the smart contract so they can be accessed on-chain.</p> <div class="custom-block tip"><p>The contract flags define <strong>how</strong> the process will behave, whereas the metadata is used to store the <strong>human readable</strong> content.</p></div> <p>In about 2-3 minutes, the Ethereum transaction will be relayed to the voting blockchain as well. When the block number reaches <code>startBlock</code>, the process will become open to those who are part of the census. The <code>startBlock</code> value should be <strong>at least 25 blocks ahead</strong> of the current value.</p> <h4 id="visualizer-2"><a href="#visualizer-2" class="header-anchor">#</a> Visualizer</h4> <p>To check the new process, there are two web sites we can use:</p> <ul><li><code>https://app.dev.vocdoni.net/processes/#/&lt;entity-id&gt;/&lt;process-id&gt;</code></li> <li><code>https://explorer.dev.vocdoni.net/process/&lt;process-id&gt;</code></li></ul> <p>In our case:</p> <ul><li><code>https://app.dev.vocdoni.net/processes/#/0xdeea56f124dd3e73bcbc210fc382154a11f3bab227af55927139c887e15573e4/0x82f42dc48bfbfa0bb1018bcb0f3a31f77d12ced1fda9566990d64d07be9a48a6</code></li> <li><code>https://explorer.dev.vocdoni.net/process/0x82f42dc48bfbfa0bb1018bcb0f3a31f77d12ced1fda9566990d64d07be9a48a6</code></li></ul> <p>Again, this is a testnet and some of this data may have been cleaned up at some point.</p> <h3 id="voting"><a href="#voting" class="header-anchor">#</a> Voting</h3> <p>The previous code typically runs on the backend of your organization -you will simply choose to generate a census based on your specific organization's parameters.</p> <p>This next portion, however, is meant to be executed on the voter's device. The specific method used to create and manage user keys is an important decision which  presents a trade off between usability and security.</p> <ul><li>Users create the keys on their end
<ul><li>This allows for a self sovereign identity and provides higher privacy</li> <li>However, users have to register the public key on your backend and you need to validate it</li></ul></li> <li>The organization creates one-time keys
<ul><li>The keys are not in the user's control</li> <li>They don't need to register</li> <li>They can simply receive a link and use it to vote, and then the key expires</li></ul></li></ul> <p>Whatever your case is, we will illustrate a web browser environment where the voter fetches the process metadata, signs his/her choices and submits them to a gateway.</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Wallet <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;ethers&quot;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>
    getVoteMetadata<span class="token punctuation">,</span>
    estimateDateAtBlock<span class="token punctuation">,</span>
    getBlockHeight<span class="token punctuation">,</span>
    getEnvelopeHeight<span class="token punctuation">,</span>
    packagePollEnvelope<span class="token punctuation">,</span>
    submitEnvelope
<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;dvote-js/dist/api/vote&quot;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> getCensusSize<span class="token punctuation">,</span> digestHexClaim<span class="token punctuation">,</span> generateProof <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;dvote-js/dist/api/census&quot;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> waitUntilVochainBlock <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;dvote-js/dist/util/waiters&quot;</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">submitSingleVote</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Get the user private key from the appropriate place</span>
    <span class="token keyword">const</span> wallet <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Wallet</span><span class="token punctuation">(</span><span class="token string">&quot;voter-privkey&quot;</span><span class="token punctuation">)</span>  <span class="token comment">// TODO: Adapt to your case</span>

    <span class="token comment">// Fetch the metadata</span>
    <span class="token keyword">const</span> processMeta <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getVoteMetadata</span><span class="token punctuation">(</span>processId<span class="token punctuation">,</span> pool<span class="token punctuation">)</span>

    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;- Starting:&quot;</span><span class="token punctuation">,</span> <span class="token keyword">await</span> <span class="token function">estimateDateAtBlock</span><span class="token punctuation">(</span>processMeta<span class="token punctuation">.</span>startBlock<span class="token punctuation">,</span> pool<span class="token punctuation">)</span><span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;- Ending:&quot;</span><span class="token punctuation">,</span> <span class="token keyword">await</span> <span class="token function">estimateDateAtBlock</span><span class="token punctuation">(</span>processMeta<span class="token punctuation">.</span>startBlock <span class="token operator">+</span> processMeta<span class="token punctuation">.</span>numberOfBlocks<span class="token punctuation">,</span> pool<span class="token punctuation">)</span><span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;- Census size:&quot;</span><span class="token punctuation">,</span> <span class="token keyword">await</span> <span class="token function">getCensusSize</span><span class="token punctuation">(</span>processMeta<span class="token punctuation">.</span>census<span class="token punctuation">.</span>merkleRoot<span class="token punctuation">,</span> pool<span class="token punctuation">)</span><span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;- Current block:&quot;</span><span class="token punctuation">,</span> <span class="token keyword">await</span> <span class="token function">getBlockHeight</span><span class="token punctuation">(</span>pool<span class="token punctuation">)</span><span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;- Current votes:&quot;</span><span class="token punctuation">,</span> <span class="token keyword">await</span> <span class="token function">getEnvelopeHeight</span><span class="token punctuation">(</span>processId<span class="token punctuation">,</span> pool<span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token keyword">await</span> <span class="token function">waitUntilVochainBlock</span><span class="token punctuation">(</span>processMeta<span class="token punctuation">.</span>startBlock<span class="token punctuation">,</span> pool<span class="token punctuation">,</span> <span class="token punctuation">{</span> verbose<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>

    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Submitting vote envelopes&quot;</span><span class="token punctuation">)</span>

    <span class="token comment">// Hash the voter's public key</span>
    <span class="token keyword">const</span> publicKeyHash <span class="token operator">=</span> <span class="token function">digestHexClaim</span><span class="token punctuation">(</span>wallet<span class="token punctuation">[</span><span class="token string">&quot;signingKey&quot;</span><span class="token punctuation">]</span><span class="token punctuation">.</span>publicKey<span class="token punctuation">)</span>

    <span class="token comment">// Generate the census proof</span>
    <span class="token keyword">const</span> merkleProof <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">generateProof</span><span class="token punctuation">(</span>processMeta<span class="token punctuation">.</span>census<span class="token punctuation">.</span>merkleRoot<span class="token punctuation">,</span> publicKeyHash<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> pool<span class="token punctuation">)</span>

    <span class="token comment">// Sign the vote envelope with our choices</span>
    <span class="token keyword">const</span> choices <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span>
    <span class="token keyword">const</span> voteEnvelope <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">packagePollEnvelope</span><span class="token punctuation">(</span><span class="token punctuation">{</span> votes<span class="token operator">:</span> choices<span class="token punctuation">,</span> merkleProof<span class="token punctuation">,</span> processId<span class="token punctuation">,</span> walletOrSigner<span class="token operator">:</span> wallet <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token comment">// If the process had encrypted votes:</span>
    <span class="token comment">// const voteEnvelope = await packagePollEnvelope({ votes, merkleProof, processId, walletOrSigner: wallet, encryptionPubKeys: [&quot;...&quot;] })</span>

    <span class="token keyword">await</span> <span class="token function">submitEnvelope</span><span class="token punctuation">(</span>voteEnvelope<span class="token punctuation">,</span> pool<span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Envelope submitted&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>That's quite a lot so far!</p> <p>To check for the status of a vote, you can append these extra calls at the end:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> getPollNullifier<span class="token punctuation">,</span> getEnvelopeStatus <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;dvote-js/dist/api/vote&quot;</span>

<span class="token punctuation">{</span>
    <span class="token comment">// ...</span>

    <span class="token comment">// wait 10+ seconds</span>
    <span class="token keyword">await</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token parameter">resolve</span> <span class="token operator">=&gt;</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> <span class="token number">1000</span> <span class="token operator">*</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token comment">// Compute our deterministic nullifier to check the status of our vote</span>
    <span class="token keyword">const</span> nullifier <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getPollNullifier</span><span class="token punctuation">(</span>wallet<span class="token punctuation">.</span>address<span class="token punctuation">,</span> processId<span class="token punctuation">)</span>
    <span class="token keyword">const</span> status <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getEnvelopeStatus</span><span class="token punctuation">(</span>processId<span class="token punctuation">,</span> nullifier<span class="token punctuation">,</span> pool<span class="token punctuation">)</span>

    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;- Registered: &quot;</span><span class="token punctuation">,</span> status<span class="token punctuation">.</span>registered<span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;- Block: &quot;</span><span class="token punctuation">,</span> status<span class="token punctuation">.</span>block<span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;- Date: &quot;</span><span class="token punctuation">,</span> status<span class="token punctuation">.</span>date<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>The output:</p> <div class="language- extra-class"><pre class="language-text"><code>- Starting: 2020-09-17T15:50:44.000Z
- Ending: 2020-09-18T15:50:44.000Z
- Census size: 10
- Current block: 5
- Current votes: 0
Waiting for Vochain block 35
Now at Vochain block 6
Now at Vochain block 7
[...]
Now at Vochain block 35`

Submitting vote envelopes
Envelope submitted

- Registered:  true
- Block:  36
- Date:  2020-09-17T15:51:06.000Z
</code></pre></div><p>This is what we just did:</p> <ul><li>Initialize the wallet with the voter's private key</li> <li>Fetch the vote metadata</li> <li>Wait until <code>startBlock</code></li> <li>Request a census merkle proof to a random Gateway, proving that the voter's public key matches the census Merkle root</li> <li>Package our choices into an envelope signed with the voter private key (and optionally encrypt it)</li> <li>Submit the envelope using a random Gateway</li> <li>Retrieve the status of the vote</li></ul> <h3 id="process-results"><a href="#process-results" class="header-anchor">#</a> Process results</h3> <p>If we look at the visualizer or the block explorer we should see votes already submitted.</p> <p>If the process type was set to <code>encrypted-poll</code> then, results would remain unavailable until the process ends. As our process is an open poll, however, we can ask for the results in real time:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> getResultsDigest <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;dvote-js/dist/api/vote&quot;</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">fetchResults</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> questions <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getResultsDigest</span><span class="token punctuation">(</span>processId<span class="token punctuation">,</span> pool<span class="token punctuation">)</span>

    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Process results&quot;</span><span class="token punctuation">,</span> questions<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>After all users have voted, the visualizer shows:</p> <p><img src="https://blog.vocdoni.io/content/images/2020/09/vocdoni_vote_count.png" alt="Process results" title="Process results"></p> <p>However, if you can't wait for an encrypted process to end later or you simply want to stop vote submissions, there's a trick you can use. This will change in the near future, but for now you can <code>cancel</code> the rest of the lifespan of a process, if needed. The scrutiny will begin a few seconds later.</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> isCanceled<span class="token punctuation">,</span> cancelProcess <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;dvote-js/dist/api/vote&quot;</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">forceEndingProcess</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Already canceled?</span>
    <span class="token keyword">const</span> canceled <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">isCanceled</span><span class="token punctuation">(</span>processId<span class="token punctuation">,</span> pool<span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>canceled<span class="token punctuation">)</span> <span class="token keyword">return</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Process already canceled&quot;</span><span class="token punctuation">)</span>

    <span class="token comment">// Already ended?</span>
    <span class="token keyword">const</span> processMeta <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getVoteMetadata</span><span class="token punctuation">(</span>processId<span class="token punctuation">,</span> pool<span class="token punctuation">)</span>
    <span class="token keyword">const</span> currentBlock <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getBlockHeight</span><span class="token punctuation">(</span>pool<span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>currentBlock <span class="token operator">&gt;=</span> <span class="token punctuation">(</span>processMeta<span class="token punctuation">.</span>startBlock <span class="token operator">+</span> processMeta<span class="token punctuation">.</span>numberOfBlocks<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Process already ended&quot;</span><span class="token punctuation">)</span>

    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Canceling process&quot;</span><span class="token punctuation">,</span> processId<span class="token punctuation">)</span>
    <span class="token keyword">await</span> <span class="token function">cancelProcess</span><span class="token punctuation">(</span>processId<span class="token punctuation">,</span> entityWallet<span class="token punctuation">,</span> pool<span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Done&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Congratulations! You just conducted an election!</p> <p>A recap of the the examples featured on the article are available on this repository:</p> <p><a href="https://github.com/vocdoni/tutorials/tree/master/voting-as-a-service" target="_blank" rel="noopener noreferrer">https://github.com/vocdoni/tutorials/tree/master/voting-as-a-service<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">10/27/2021, 10:11:39 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      
      <a href="/integration/how-it-works.html" class="prev">
        How It Works
      </a></span> <span class="next"><a href="/integration/census/on-chain.html">
        On-chain Census
      </a>
      
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.003a3fab.js" defer></script><script src="/assets/js/2.d75a9e61.js" defer></script><script src="/assets/js/55.496f36cc.js" defer></script>
  </body>
</html>

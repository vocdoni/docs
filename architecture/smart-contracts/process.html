<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Process Contract | Vocdoni</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="A decentralized self sovereign governance platform">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    
    <link rel="preload" href="/assets/css/0.styles.b4782a24.css" as="style"><link rel="preload" href="/assets/js/app.003a3fab.js" as="script"><link rel="preload" href="/assets/js/2.d75a9e61.js" as="script"><link rel="preload" href="/assets/js/39.bf4aa161.js" as="script"><link rel="prefetch" href="/assets/js/10.7d736aa9.js"><link rel="prefetch" href="/assets/js/11.24f4b6a1.js"><link rel="prefetch" href="/assets/js/12.fbc7926a.js"><link rel="prefetch" href="/assets/js/13.1d48d867.js"><link rel="prefetch" href="/assets/js/14.f1695afd.js"><link rel="prefetch" href="/assets/js/15.fd5bd6ca.js"><link rel="prefetch" href="/assets/js/16.7848fcf4.js"><link rel="prefetch" href="/assets/js/17.a09d0fce.js"><link rel="prefetch" href="/assets/js/18.2d6d7bd0.js"><link rel="prefetch" href="/assets/js/19.7ca86ba4.js"><link rel="prefetch" href="/assets/js/20.7610a2ee.js"><link rel="prefetch" href="/assets/js/21.a33e4585.js"><link rel="prefetch" href="/assets/js/22.cdbbe0cb.js"><link rel="prefetch" href="/assets/js/23.daf8da8a.js"><link rel="prefetch" href="/assets/js/24.33f4a899.js"><link rel="prefetch" href="/assets/js/25.ca7b1363.js"><link rel="prefetch" href="/assets/js/26.00dda6a7.js"><link rel="prefetch" href="/assets/js/27.9643f5df.js"><link rel="prefetch" href="/assets/js/28.95fc6467.js"><link rel="prefetch" href="/assets/js/29.6d11f8e1.js"><link rel="prefetch" href="/assets/js/3.87bd6438.js"><link rel="prefetch" href="/assets/js/30.5f4b8604.js"><link rel="prefetch" href="/assets/js/31.57338027.js"><link rel="prefetch" href="/assets/js/32.c6e6f766.js"><link rel="prefetch" href="/assets/js/33.ee83017b.js"><link rel="prefetch" href="/assets/js/34.9adc375a.js"><link rel="prefetch" href="/assets/js/35.5a5f7bb7.js"><link rel="prefetch" href="/assets/js/36.e2545582.js"><link rel="prefetch" href="/assets/js/37.0eb8cc70.js"><link rel="prefetch" href="/assets/js/38.84124562.js"><link rel="prefetch" href="/assets/js/4.6ba5942f.js"><link rel="prefetch" href="/assets/js/40.11b0e7ee.js"><link rel="prefetch" href="/assets/js/41.e727669e.js"><link rel="prefetch" href="/assets/js/42.995b740c.js"><link rel="prefetch" href="/assets/js/43.6a147059.js"><link rel="prefetch" href="/assets/js/44.a2bf17a5.js"><link rel="prefetch" href="/assets/js/45.3ff1d0d1.js"><link rel="prefetch" href="/assets/js/46.c84ab2db.js"><link rel="prefetch" href="/assets/js/47.b5fc1bda.js"><link rel="prefetch" href="/assets/js/48.87932f25.js"><link rel="prefetch" href="/assets/js/49.1b5e3ca0.js"><link rel="prefetch" href="/assets/js/5.0c02ed2b.js"><link rel="prefetch" href="/assets/js/50.0c49f3da.js"><link rel="prefetch" href="/assets/js/51.05425652.js"><link rel="prefetch" href="/assets/js/52.51995a7a.js"><link rel="prefetch" href="/assets/js/53.cd441341.js"><link rel="prefetch" href="/assets/js/54.69d5ba43.js"><link rel="prefetch" href="/assets/js/55.496f36cc.js"><link rel="prefetch" href="/assets/js/56.f98a821f.js"><link rel="prefetch" href="/assets/js/57.bf2fdef7.js"><link rel="prefetch" href="/assets/js/58.f208592f.js"><link rel="prefetch" href="/assets/js/59.a1cf2460.js"><link rel="prefetch" href="/assets/js/6.75834963.js"><link rel="prefetch" href="/assets/js/60.59aefd15.js"><link rel="prefetch" href="/assets/js/7.0929d87c.js"><link rel="prefetch" href="/assets/js/8.66ffbfac.js"><link rel="prefetch" href="/assets/js/9.5e86fdd3.js">
    <link rel="stylesheet" href="/assets/css/0.styles.b4782a24.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Vocdoni</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/architecture/general.html" class="nav-link">
  Architecture
</a></div><div class="nav-item"><a href="https://blog.vocdoni.io/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Blog
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="/about-us/vision.html" class="nav-link">
  About us
</a></div><div class="nav-item"><a href="https://discord.gg/sQCxgYs" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Discord
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/architecture/general.html" class="nav-link">
  Architecture
</a></div><div class="nav-item"><a href="https://blog.vocdoni.io/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Blog
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="/about-us/vision.html" class="nav-link">
  About us
</a></div><div class="nav-item"><a href="https://discord.gg/sQCxgYs" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Discord
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><a href="/architecture/general" class="sidebar-heading clickable open"><span>Architecture</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/architecture/general.html" class="sidebar-link">Global Architecture</a></li><li><a href="/architecture/process-overview.html" class="sidebar-link">Process Overview</a></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/architecture/census/census-overview" class="sidebar-heading clickable"><span>The Census</span> <span class="arrow right"></span></a> <!----></section></li><li><a href="/architecture/components.html" class="sidebar-link">Component Overview</a></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/architecture/smart-contracts/entity-resolver" class="sidebar-heading clickable open"><span>Smart Contracts</span> <span class="arrow down"></span></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/architecture/smart-contracts/entity-resolver.html" class="sidebar-link">Entity Resolver Contract</a></li><li><a href="/architecture/smart-contracts/process.html" aria-current="page" class="active sidebar-link">Process Contract</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/architecture/smart-contracts/genesis.html" class="sidebar-link">Genesis Contract</a></li><li><a href="/architecture/smart-contracts/namespace.html" class="sidebar-link">Namespace Contract</a></li><li><a href="/architecture/smart-contracts/results.html" class="sidebar-link">Results Contract</a></li><li><a href="/architecture/smart-contracts/storage-proofs.html" class="sidebar-link">Storage Proofs Contracts</a></li></ul></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/architecture/services/gateway" class="sidebar-heading clickable"><span>Services</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/architecture/data-schemes/entity-metadata" class="sidebar-heading clickable"><span>Data Schemes</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/architecture/protocol/json-api" class="sidebar-heading clickable"><span>Protocol</span> <span class="arrow right"></span></a> <!----></section></li><li><a href="/architecture/component-interaction.html" class="sidebar-link">Component Interaction</a></li><li><a href="/architecture/libraries-tooling.html" class="sidebar-link">Libraries and Tooling</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/integration/overview" class="sidebar-heading clickable"><span>Integration</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/integration/overview.html" class="sidebar-link">Overview</a></li><li><a href="/integration/getting-started-local-vochain.html" class="sidebar-link">Getting started with a local instance</a></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/integration/vaas-api" class="sidebar-heading clickable"><span>Voting as a Service</span> <span class="arrow right"></span></a> <!----></section></li><li><a href="/integration/manual-integration.html" class="sidebar-link">Manual Integration</a></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/integration/census/general" class="sidebar-heading clickable"><span>Census</span> <span class="arrow right"></span></a> <!----></section></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/deployment/gateway" class="sidebar-heading clickable"><span>Deployment</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/deployment/gateway.html" class="sidebar-link">Gateway Deployment (stage)</a></li><li><a href="/deployment/miner.html" class="sidebar-link">Miner Deployment</a></li><li><a href="/deployment/oracle.html" class="sidebar-link">Oracle Deployment (stage)</a></li><li><a href="/deployment/custom-vochain.html" class="sidebar-link">Custom Vochain Deployment</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/about-us/vision" class="sidebar-heading clickable"><span>About</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/about-us/vision.html" class="sidebar-link">Vision</a></li><li><a href="/about-us/how-we-work.html" class="sidebar-link">How We Work</a></li><li><section class="sidebar-group is-sub-group depth-1"><a href="/about-us/development-guidelines" class="sidebar-heading clickable"><span>Development Guidelines</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/about-us/development-guidelines.html" class="sidebar-link">Development guidelines</a></li><li><a href="/about-us/repository-branching.html" class="sidebar-link">Repository and branching guidelines</a></li></ul></section></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="process-contract"><a href="#process-contract" class="header-anchor">#</a> Process Contract</h1> <p>A process is the building block around which governance is made in Vocdoni. Similarly to an Operating System, think of the Processes contract like a Kernel that receives syscalls to spawn a new governance process.</p> <p>Governance processes span across three different components: the Ethereum smart contract, IPFS to ditribute <a href="/architecture/data-schemes/process.html#process-metadata">the vote metadata</a> and the <a href="/architecture/services/vochain">Vochain</a>.</p> <p>Processes follow a declarative fashion. The expected behavior is declared on the smart contract for integrity and then the voting blockchain (called <a href="/architecture/services/vochain">Vochain</a>) reacts according to the current settings.</p> <p>The instance of the Voting process contract is resolved from <code>processes.vocdoni.eth</code> on the ENS registry.</p> <ul><li><a href="#contract-structs">Contract structs</a></li> <li><a href="#process-id">Process ID</a></li> <li><a href="#methods">Methods</a></li> <li><a href="#getters">Getters</a></li> <li><a href="#flags">Flags</a></li> <li><a href="#process-status">Status</a></li> <li><a href="#transparent-upgrades">Transparent upgrades</a></li></ul> <h3 id="contract-structs"><a href="#contract-structs" class="header-anchor">#</a> Contract structs</h3> <div class="language-solidity extra-class"><pre class="language-solidity"><code>
<span class="token comment">// GLOBAL STRUCTS</span>

<span class="token keyword">struct</span> <span class="token class-name">Process</span> <span class="token punctuation">{</span>
    <span class="token builtin">uint8</span> mode<span class="token punctuation">;</span> <span class="token comment">// The selected process mode. See: https://docs.vocdoni.io/architecture/smart-contracts/process.html#flags</span>
    <span class="token builtin">uint8</span> envelopeType<span class="token punctuation">;</span> <span class="token comment">// One of valid envelope types, see: https://docs.vocdoni.io/architecture/smart-contracts/process.html#flags</span>
    CensusOrigin censusOrigin<span class="token punctuation">;</span> <span class="token comment">// How the census proofs are computed (Off-chain vs EVM Merkle Tree)</span>

    <span class="token builtin">address</span> entity<span class="token punctuation">;</span> <span class="token comment">// The address of the Entity (or contract) holding the process</span>
    <span class="token builtin">uint32</span> startBlock<span class="token punctuation">;</span> <span class="token comment">// Vochain block number on which the voting process starts</span>
    <span class="token builtin">uint32</span> blockCount<span class="token punctuation">;</span> <span class="token comment">// Amount of Vochain blocks during which the voting process should be active</span>

    <span class="token builtin">string</span> metadata<span class="token punctuation">;</span> <span class="token comment">// Content Hashed URI of the JSON meta data (See Data Origins)</span>
    <span class="token builtin">string</span> censusRoot<span class="token punctuation">;</span> <span class="token comment">// Hex string with the Census Root. Depending on the census origin, it will be a Merkle Root or a public key.</span>
    <span class="token builtin">string</span> censusUri<span class="token punctuation">;</span> <span class="token comment">// Content Hashed URI of the exported Merkle Tree (not including the public keys)</span>

    Status status<span class="token punctuation">;</span> <span class="token comment">// One of 0 [ready], 1 [ended], 2 [canceled], 3 [paused], 4 [results]</span>
    <span class="token builtin">uint8</span> questionIndex<span class="token punctuation">;</span> <span class="token comment">// The index of the currently active question (only assembly processes)</span>

    <span class="token comment">// How many questions are available to vote</span>
    <span class="token comment">// questionCount &gt;= 1</span>
    <span class="token builtin">uint8</span> questionCount<span class="token punctuation">;</span>

    <span class="token comment">// How many choices can be made for each question.</span>
    <span class="token comment">// 1 &lt;= maxCount &lt;= 100</span>
    <span class="token builtin">uint8</span> maxCount<span class="token punctuation">;</span>

    <span class="token comment">// Determines the acceptable value range.</span>
    <span class="token comment">// N =&gt; valid votes will range from 0 to N (inclusive)</span>
    <span class="token builtin">uint8</span> maxValue<span class="token punctuation">;</span>

    <span class="token builtin">uint8</span> maxVoteOverwrites<span class="token punctuation">;</span> <span class="token comment">// How many times a vote can be replaced (only the last one counts)</span>

    <span class="token comment">// Limits up to how much cost, the values of a vote can add up to (if applicable).</span>
    <span class="token comment">// 0 =&gt; No limit / Not applicable</span>
    <span class="token builtin">uint16</span> maxTotalCost<span class="token punctuation">;</span>

    <span class="token comment">// Defines the exponent that will be used to compute the &quot;cost&quot; of the options voted and compare it against `maxTotalCost`.</span>
    <span class="token comment">// totalCost = Σ (value[i] ** costExponent) &lt;= maxTotalCost</span>
    <span class="token comment">//</span>
    <span class="token comment">// Exponent range:</span>
    <span class="token comment">// - 0 =&gt; 0.0000</span>
    <span class="token comment">// - 10000 =&gt; 1.0000</span>
    <span class="token comment">// - 65535 =&gt; 6.5535</span>
    <span class="token builtin">uint16</span> costExponent<span class="token punctuation">;</span>

    <span class="token builtin">uint256</span> evmBlockHeight<span class="token punctuation">;</span> <span class="token comment">// EVM block number to use as a snapshot for the on-chain census</span>

    <span class="token builtin">bytes32</span> paramsSignature<span class="token punctuation">;</span> <span class="token comment">// entity.sign({...}) // fields that the oracle uses to authenticate process creation</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="process-id"><a href="#process-id" class="header-anchor">#</a> Process ID</h3> <p>Processes are uniquely identified by their <code>processId</code></p> <p>It is the result of combining and hashing these three values:</p> <ul><li><code>entityAddress</code></li> <li><code>processCountIndex</code></li> <li><code>namespace</code></li></ul> <div class="language-solidity extra-class"><pre class="language-solidity"><code><span class="token keyword">function</span> <span class="token function">getNextProcessId</span><span class="token punctuation">(</span><span class="token builtin">address</span> entityAddress<span class="token punctuation">)</span> <span class="token keyword">public</span> <span class="token keyword">view</span> override <span class="token keyword">returns</span> <span class="token punctuation">(</span><span class="token builtin">bytes32</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// From 0 to N-1, the next index is N</span>
    <span class="token builtin">uint256</span> processCount <span class="token operator">=</span> <span class="token function">getEntityProcessCount</span><span class="token punctuation">(</span>entityAddress<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token function">getProcessId</span><span class="token punctuation">(</span>entityAddress<span class="token punctuation">,</span> processCount<span class="token punctuation">,</span> namespaceId<span class="token punctuation">,</span> ethChainId<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">getProcessId</span><span class="token punctuation">(</span><span class="token builtin">address</span> entityAddress<span class="token punctuation">,</span> <span class="token builtin">uint256</span> processCountIndex<span class="token punctuation">,</span> <span class="token builtin">uint32</span> namespaceIdNum<span class="token punctuation">,</span> <span class="token builtin">uint32</span> ethereumChainId<span class="token punctuation">)</span> <span class="token keyword">public</span> <span class="token keyword">pure</span> override <span class="token keyword">returns</span> <span class="token punctuation">(</span><span class="token builtin">bytes32</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">keccak256</span><span class="token punctuation">(</span>abi<span class="token punctuation">.</span><span class="token function">encodePacked</span><span class="token punctuation">(</span>entityAddress<span class="token punctuation">,</span> processCountIndex<span class="token punctuation">,</span> namespaceIdNum<span class="token punctuation">,</span> ethereumChainId<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Where:</p> <ul><li><code>entityAddress</code> is the Ethereum address that creates the process (or the token address)</li> <li><code>entityProcessCount</code> is an incremental nonce per <code>entityAddress</code></li> <li><code>ethereumChainId</code> is the Ethereum chain Id where this contract has been deployed to</li> <li><code>namespaceId</code> is a number that the process contract is assigned when it is deployed. See the <a href="/architecture/smart-contracts/namespace">Namespace contract</a></li></ul> <h3 id="methods"><a href="#methods" class="header-anchor">#</a> Methods</h3> <ul><li><code>newProcess()</code> <ul><li>Sets the parameters of a new process to be run on the Vochain</li> <li>If <code>processPrice</code> is defined to prevent spam, the transaction must include a <code>value</code> with at least such amount.</li></ul></li> <li><code>setStatus()</code> <ul><li>With the appropriate flags, the creator can set the process to be <code>READY</code>, <code>ENDED</code>, <code>CANCELED</code> or <code>PAUSED</code>.</li> <li>See <a href="#status">process status</a> below</li></ul></li> <li><code>incrementQuestionIndex()</code> <ul><li>With the appropriate flags, the creator can define the question that can be voted on</li></ul></li> <li><code>setCensus()</code> <ul><li>With the appropriate flags, the creator can update the census for long lasting polls</li></ul></li></ul> <p>For more details, you can see the <a href="https://github.com/vocdoni/dvote-solidity/blob/main/contracts/processes.sol" target="_blank" rel="noopener noreferrer">implementation here<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h3 id="getters"><a href="#getters" class="header-anchor">#</a> Getters</h3> <ul><li><code>get()</code> <ul><li>Retrieves all the parameters and flags defined for the given process</li></ul></li> <li><code>getParamsSignature()</code> <ul><li>Retrieves the signature of the parameters above</li></ul></li> <li><code>getCreationInstance()</code> <ul><li>Returns the address of the process contract where the given process is hosted</li> <li>Useful to determine where an update needs to be sent to (see Transparent upgrades next)</li></ul></li></ul> <h3 id="flags"><a href="#flags" class="header-anchor">#</a> Flags</h3> <p>When a process is created, the entity needs to define what options apply to it. The combination of them produces:</p> <ul><li>The process <code>mode</code> <ul><li>It determines the external behavior of the process, when it starts, what can be updated, etc.</li></ul></li> <li>The <code>envelopeType</code> <ul><li>Determines the internal behavior of the votes sent by participants.</li></ul></li> <li>The <code>censusOrigin</code> <ul><li>Determines the way to compute and validate the voter's census proofs</li></ul></li></ul> <p>There is the case where the entity wants to start the process as soon as possible. Because of the nature
of a blockchain it is not possible to know at which block a transaction will be mined/sealed and selecting
an approximate block number in the future could not work if the block number selected is very close to the current
block number.
For these cases an entity can use a special block number <code>startBlock = 1</code> if the process mode flag <code>AUTO_START</code> is
set to <code>true</code>. If a process is created with this flags the <code>startBlock</code> of the process will be changed by the Oracles
sending the transaction to the Vochain and will be set to the current Vochain block plus some delay to ensure the
that the <code>startBlock</code> is never less than the current Vochain block.
The process will be ready to receive votes as soon as the transaction sended by the Oracles is mined.</p> <h4 id="process-mode"><a href="#process-mode" class="header-anchor">#</a> Process Mode</h4> <p>The process mode affects both the Vochain, the contract itself and even the metadata. Its value is generated by combining the flags below.</p> <div class="language- extra-class"><pre class="language-text"><code>0b00011111
     |||||
     ||||`- autoStart
     |||`-- interruptible
     ||`--- dynamicCensus
     |`---- encryptedMetadata
     `----- preRegister
</code></pre></div><h5 id="auto-start"><a href="#auto-start" class="header-anchor">#</a> AUTO_START</h5> <ul><li><code>false</code> ⇒ The process needs to be set to <code>READY</code> by the creator before it can start. Processes start <code>PAUSED</code> by default.</li> <li><code>true</code> ⇒ Votes will be processes starting at block <code>startBlock</code>.</li></ul> <p><code>newProcess()</code> enforces <code>startBlock</code> &gt; 0 accordingly</p> <h5 id="interruptible"><a href="#interruptible" class="header-anchor">#</a> INTERRUPTIBLE</h5> <ul><li><code>false</code> ⇒ The Vochain will <code>END</code> the process when the block <code>startBlock + blockCount</code> is reached</li> <li><code>true</code> ⇒ In addition to the above, the admin can <code>END</code>, <code>PAUSE</code> and <code>CANCEL</code> it
<ul><li>Pausing a process prevents votes from being received and <code>blockCount</code> stays unchanged by now</li></ul></li></ul> <h5 id="dynamic-census"><a href="#dynamic-census" class="header-anchor">#</a> DYNAMIC_CENSUS</h5> <ul><li><code>false</code> ⇒ The census is immutable</li> <li><code>true</code> ⇒ The census can be edited during the life-cycle of the process. Allowing to add, subtract new keys, or change the census entirely, to a process that has already started.
<ul><li>Intended for low stake, long-term polls only</li> <li>Warning: The admin would have the opportunity to cheat by enabling keys and then removing them later on</li></ul></li></ul> <h5 id="encrypted-metadata"><a href="#encrypted-metadata" class="header-anchor">#</a> ENCRYPTED_METADATA</h5> <ul><li><code>false</code> ⇒ The processMetadata should be in plain text</li> <li><code>true</code> ⇒ The questions and options of a process should be encrypted, so an observer of the network won't be able to see what the process is about unless he/she has the key.</li></ul> <p>It requires a prior process to share the encryption key with the users with the right to read the data. This will be likely be handled by the <code>User Registry</code>.</p> <h5 id="pre-register"><a href="#pre-register" class="header-anchor">#</a> PRE_REGISTER</h5> <ul><li><code>false</code> ⇒ There is not registration phase, thus the census root used for validate votes is the <code>CensusRoot</code> parameter defined by the <code>newProcessTx</code> transaction.</li> <li><code>true</code> ⇒ There is a registration phase, the census root parameter defined by <code>newProcessTx</code> is used only during the registration (before the process <code>startBlock</code> is reached). The voting <code>CensusRoot</code> will be built inside the Vochain when registerVoterKeyTx are send by the elegible voters.</li></ul> <h4 id="envelope-type"><a href="#envelope-type" class="header-anchor">#</a> Envelope Type</h4> <p>The envelope type tells how the vote envelope is formatted and handled. Its value is generated by combining the flags below.</p> <div class="language- extra-class"><pre class="language-text"><code>0b00011111
     |||||
     ||||`- serial
     |||`-- anonymous
     ||`--- encryptedVotes
     |`---- uniqueValues
      `---- costFromWeight 
</code></pre></div><h5 id="serial"><a href="#serial" class="header-anchor">#</a> SERIAL</h5> <ul><li><code>false</code> A single envelope is expected with all votes in it</li> <li><code>true</code> An envelope needs to be sent for each question, as <code>questionIndex</code> is incremented</li></ul> <h5 id="anonymous"><a href="#anonymous" class="header-anchor">#</a> ANONYMOUS</h5> <ul><li><code>false</code> The voter identity (public key) can be known and therefore, the vote is pseudonymous. If an observer can correlate the voter public key with personal data, the voter could be identified.</li> <li><code>true</code> The voter public key can't be known. Instead, the voter will submit a ZK-snark proof, ensuring that:
<ul><li>He/she belongs to the census of the process</li> <li>He/she has not already voted on the process</li></ul></li></ul> <h5 id="encrypted-vote"><a href="#encrypted-vote" class="header-anchor">#</a> ENCRYPTED_VOTE</h5> <ul><li><code>false</code> Votes are sent in plain text. Results can be seen in real time.</li> <li><code>true</code> The vote payload will be encrypted. The results will become available once the encryption key is published at the end of the process by the miners.</li></ul> <h5 id="unique-values"><a href="#unique-values" class="header-anchor">#</a> UNIQUE_VALUES</h5> <ul><li><code>false</code> The same vote value can be chosen more than once</li> <li><code>true</code> Choices must be unique across a field</li></ul> <h5 id="cost-from-weight"><a href="#cost-from-weight" class="header-anchor">#</a> COST_FROM_WEIGHT</h5> <ul><li><code>true</code> On EVM-based census processes (weighted), the user's balance will be used as the <code>maxCost</code>. This allows splitting the voting power among several choices, even including quadratic voting scenarios.</li> <li><code>false</code> The max cost will be taken from the value on the smart contract, being the same for everyone.</li></ul> <h4 id="census-origin"><a href="#census-origin" class="header-anchor">#</a> Census Origin</h4> <p>The census origin is an unsigned integer holding a value defined by the following enumeration:</p> <ul><li><code>OFF_CHAIN_TREE</code> (1)
<ul><li>An exhaustive Merkle Tree contains the list of (hashed) keys allowed to vote and its root is stored on <code>censusRoot</code>.</li></ul></li> <li><code>OFF_CHAIN_TREE_WEIGHTED</code> (2)
<ul><li>An exhaustive Merkle Tree contains the list of (hashed) keys allowed to vote and their respective voting power. Its root is also stored on <code>censusRoot</code>.</li></ul></li> <li><code>OFF_CHAIN_CA</code> (3)
<ul><li>A certification authority issues signatures for all eligible voters on a per-process basis. The public key of the CA is stored on <code>censusRoot</code>.</li></ul></li> <li><code>ERC20</code> (11)
<ul><li>All the token holders of an ERC20 token (under the contract at the address of <code>entity</code>) are eligible to vote. <code>censusRoot</code> contains the storage (Merkle) root of the token contract at the <code>evmBlockHeight</code>.</li></ul></li> <li><code>ERC721</code> (12)
<ul><li>Same as the ERC20 case, but for ERC721 contracts</li></ul></li> <li><code>ERC1155</code> (13)
<ul><li>Same as the ERC20 case, but for ERC1155 contracts</li></ul></li> <li><code>ERC777</code> (14)
<ul><li>Same as the ERC20 case, but for ERC777 contracts</li></ul></li> <li><code>MINI_ME</code> (15)
<ul><li>Same as the ERC20 case, but for MiniMe (ERC20) contracts</li></ul></li></ul> <h3 id="process-status"><a href="#process-status" class="header-anchor">#</a> Process Status</h3> <p>The status of a process is a simple enum, defined as follows:</p> <ul><li><code>READY</code> (0)
<ul><li>The process is marked as ready. It is intended as a <strong>passive authorization</strong> to open the process</li> <li>Vochain nodes will accept incoming votes if <code>AUTO_START</code> is disabled</li> <li>Otherwise, they will accept votes when the Vochain block number reaches <code>startBlock</code></li></ul></li> <li><code>ENDED</code> (1)
<ul><li>Tells the Vochain to stop accepting votes and start computing the results (if not already available)</li> <li>Only when <code>INTERRUPTIBLE</code> is set</li></ul></li> <li><code>CANCELED</code> (2)
<ul><li>Tells the Vochain to stop accepting votes and drop the existing data. No results will be published.</li> <li>Only when <code>INTERRUPTIBLE</code> is set</li></ul></li> <li><code>PAUSED</code> (3)
<ul><li>Tells the Vochain to stop processing votes temporarily. The process might be resumed in the future.</li> <li>Only when <code>INTERRUPTIBLE</code> is set, or after creation if <code>AUTO_START</code> is not set</li></ul></li> <li><code>RESULTS</code> (4)
<ul><li>Set by the Oracle from the Results contract as soon as the tally of a process has become available</li></ul></li></ul> <h3 id="transparent-upgrades"><a href="#transparent-upgrades" class="header-anchor">#</a> Transparent upgrades</h3> <p>Even if there are tools to deploy upgradeable smart contracts, we believe that newer versions of a contract should not be able to alter any of processes stored in the past. Existing data should remain intact, independently of future contract versions. In order to enforce transparency and full auditability:</p> <ul><li>Upcoming contract versions allow to keep historical data by forking and chaining new instances</li> <li>A common interface is available between old and new instances, so that backwards compatibility is preserved</li> <li>When a new instance is deployed, it can have a <strong>predecessor</strong>, which can <code>activate</code> the new version as its <strong>successor</strong></li> <li>New processes can only be created on the last successor of the chain</li> <li>From successors, clients can navigate back in time transparently and read processes stored on old instances</li></ul> <p>This behavior is encapsulated <a href="https://github.com/vocdoni/dvote-solidity/blob/main/contracts/base.sol#L22" target="_blank" rel="noopener noreferrer">into the <code>Chained</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> base contract.</p> <p>However:</p> <ul><li><a href="https://solidity.readthedocs.io/en/v0.6.0/security-considerations.html#tx-origin" target="_blank" rel="noopener noreferrer">Due to security concerns<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, updates on a process coming from a successor are not acceptable</li> <li>Updates on legacy processes need to be sent directly to the original contract instance</li> <li>Use <code>getCreationInstance(processId)</code> to retrieve the appropriate address</li></ul></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">12/21/2021, 10:51:16 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/architecture/smart-contracts/entity-resolver.html" class="prev">
        Entity Resolver Contract
      </a></span> <span class="next"><a href="/architecture/smart-contracts/genesis.html">
        Genesis Contract
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.003a3fab.js" defer></script><script src="/assets/js/2.d75a9e61.js" defer></script><script src="/assets/js/39.bf4aa161.js" defer></script>
  </body>
</html>
